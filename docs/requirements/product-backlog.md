# プロダクトバックログ

## 概要

本ドキュメントは、エイ・フォース勤怠管理アプリのプロダクトバックログを定義します。機能要件（FR-001〜FR-008）と受け入れ基準（AC-XXX-X）を基に、エピックとユーザーストーリーを整理しています。

## バックログ管理方針

- **優先順位**: Must要件（FR-001, FR-002, FR-003, FR-004, FR-008）を最優先
- **開発フェーズ**: Phase 2-3（基盤構築・MVP）のタスクを優先
- **見積り**: ストーリーポイント（相対見積り）を使用
- **更新頻度**: 開発の進捗に応じて随時更新

---

## エピック一覧

### Epic 1: 認証・認可（FR-001）
**優先度**: Must（P0）  
**開発フェーズ**: Phase 2（基盤構築）  
**概要**: Google OAuth2によるログイン、4つのロール管理（システム管理者/マネージャー/社員/パートナー）、メールアドレス登録・管理機能

### Epic 2: 日報管理（FR-002）
**優先度**: Must（P0）  
**開発フェーズ**: Phase 3（MVP - コア機能）  
**概要**: 日報作成、テンプレート編集、履歴検索、提出状況トラッキング、勤務地選択機能

### Epic 3: 休日登録（FR-003）
**優先度**: Must（P0）  
**開発フェーズ**: Phase 3（MVP - コア機能）、Phase 4（拡張機能）  
**概要**: 休日登録と勤務表への自動反映（コア機能）、カレンダー表示とOutlookカレンダー連携（拡張機能）

### Epic 4: 勤務表管理（FR-004）
**優先度**: Must（P0）  
**開発フェーズ**: Phase 3（MVP - コア機能）  
**概要**: 日次入力、月次集計・提出、Excelエクスポート、SharePoint自動アップロード、顧客名・プロジェクト名設定、自動出力機能

### Epic 5: アイデア共有（FR-006）
**優先度**: Should（P2）  
**開発フェーズ**: Phase 5（高度な機能）  
**概要**: アイデア投稿、評価、コメント、ステータス管理機能

### Epic 6: スケジュール集約（FR-007）
**優先度**: Should（P2）  
**開発フェーズ**: Phase 5（高度な機能）  
**概要**: Outlookカレンダー連携による社内イベント・期限タスクのカレンダー表示機能

### Epic 7: 通知（FR-008）
**優先度**: Must（P0）  
**開発フェーズ**: Phase 4（拡張機能）  
**概要**: 日報未提出アラート、勤務表入力未完了通知、通知設定（ON/OFF）機能

### Epic 8: インフラ構築
**優先度**: Must（P0）  
**開発フェーズ**: Phase 2, Phase 6（基盤構築、運用準備）  
**概要**: IaCによるAWSリソース管理、Lambda別プロジェクト、CI/CD構築

---

## ユーザーストーリー詳細

### Epic 1: 認証・認可（FR-001）

#### US-001-1: Google OAuth2ログイン機能
**受け入れ基準**: AC-001-1  
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
ユーザーとして、Googleアカウントでログインしたい、アプリケーションにアクセスできるようにするため。

**詳細**:
- Google OAuth2認証を実装
- ログイン画面の作成
- セッション管理の実装
- ユーザー情報の取得・保存

#### US-001-2: ロール管理機能
**受け入れ基準**: AC-001-2  
**優先度**: P0  
**見積り**: 3ポイント  
**説明**:  
システムとして、4つのロール（システム管理者/マネージャー/社員/パートナー）を管理したい、権限に応じたアクセス制御を実現するため。

**詳細**:
- ロール定義の実装
- ロール割り当て機能
- RBAC Guardの実装（`@Roles()` デコレータ）

#### US-001-3: メールアドレス管理機能
**受け入れ基準**: AC-001-3  
**優先度**: P0  
**見積り**: 2ポイント  
**説明**:  
ユーザーとして、メールアドレスを登録・編集したい、日報等を自分のメールアドレスから送信できるようにするため。

**詳細**:
- メールアドレス登録・編集画面
- メールアドレス保存機能
- 日報送信時のメールアドレス使用機能

---

### Epic 2: 日報管理（FR-002）

#### US-002-1: 日報作成機能
**受け入れ基準**: AC-002-1  
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
ユーザーとして、日報を作成したい、業務内容を記録・提出するため。

**詳細**:
- 日報作成画面（日付、業務内容、成果、課題、翌日予定等）
- 日付バリデーション（形式、重複チェック、未来日付チェック）
- 勤務地選択機能（飯田橋/客先常駐/自宅等）
- 日報保存機能
- 送信完了通知

**考慮事項**:
- 日報提出時に午前休・午後休を選択した場合、勤務表への反映時に適切に処理する必要がある
- 午前休・午後休の場合、勤務表には勤務時間（午後または午前の勤務時間）と休日の選択（午前休または午後休）の両方が出力される必要がある

#### US-002-2: 日報テンプレート編集機能（拡張機能）
**受け入れ基準**: AC-002-2  
**優先度**: P2（将来拡張）  
**開発フェーズ**: 将来拡張（Phase 5以降）  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、日報テンプレートを編集したい、効率的に日報を作成するため。

**備考**: 
- MVPでは固定の基本テンプレートのみを実装
- テンプレート編集機能は将来の拡張機能として検討
- ユーザーからの要望に応じて実装を検討

**詳細**:
- テンプレート編集画面
- テンプレート保存機能
- 日報作成時のテンプレート適用機能

#### US-002-3: 日報履歴検索機能
**受け入れ基準**: AC-002-3  
**優先度**: P1  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、過去の日報を検索したい、過去の業務内容を確認するため。

**詳細**:
- 日報履歴画面
- 検索機能（日付範囲、キーワード）
- 検索結果表示

#### US-002-4: 日報提出状況トラッキング機能
**受け入れ基準**: AC-002-4  
**優先度**: P1  
**見積り**: 2ポイント  
**説明**:  
ユーザーとして、日報の提出状況を確認したい、未提出を防ぐため。

**詳細**:
- 提出状況表示画面
- 提出済み/未提出の表示
- 提出率計算機能

---

### Epic 3: 休日登録（FR-003）

#### US-003-1: 休日登録機能
**受け入れ基準**: AC-003-1  
**優先度**: P0  
**開発フェーズ**: Phase 3（MVP - コア機能）  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、休日を登録したい、勤務表に自動反映させるため。

**詳細**:
- 休日登録画面（開始日、終了日、期間、理由等）
- 日付バリデーション（形式、期間チェック、重複チェック）
- 休日情報保存機能

**考慮事項**:
- 午前休・午後休の登録に対応する必要がある
- 午前休・午後休の場合、勤務表には勤務時間と休日の選択の両方が出力される必要がある

#### US-003-2: カレンダー表示機能
**受け入れ基準**: AC-003-2  
**優先度**: P1  
**開発フェーズ**: Phase 4（拡張機能）  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、登録した休日をカレンダーで確認したい、視覚的に把握するため。

**詳細**:
- カレンダー表示画面
- 月次・週次表示機能
- 休日の可視化

#### US-003-3: 勤務表への自動反映機能
**受け入れ基準**: AC-003-3  
**優先度**: P0  
**開発フェーズ**: Phase 3（MVP - コア機能）  
**見積り**: 2ポイント  
**説明**:  
システムとして、休日登録を勤務表に自動反映したい、手動調整を不要にするため。

**詳細**:
- 休日登録時の勤務表自動反映処理
- 勤務表への休日情報反映

**考慮事項**:
- 午前休・午後休の場合、勤務表には勤務時間（午後または午前の勤務時間）と休日の選択（午前休または午後休）の両方を出力する必要がある
- 全日休の場合は休日のみを出力

#### US-003-4: Outlookカレンダー連携機能（Microsoft Graph API）
**受け入れ基準**: AC-003-4  
**優先度**: P1  
**開発フェーズ**: Phase 4（拡張機能）  
**見積り**: 8ポイント  
**説明**:  
ユーザーとして、休日をOutlookカレンダーに自動登録したい、チームで確認できるようにするため。

**詳細**:
- Microsoft Graph API認証フロー（ユーザー認証方式）
- アクセストークン取得・保存機能
- Outlookカレンダーへの休日登録機能
- リフレッシュトークンによる自動更新機能

---

### Epic 4: 勤務表管理（FR-004）

#### US-004-1: 日次入力機能
**受け入れ基準**: AC-004-1  
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
ユーザーとして、勤務表を日次で入力したい、月次集計のためのデータを蓄積するため。

**詳細**:
- 日次入力画面（日付、勤務時間、休憩時間、勤務地等）
- 日付バリデーション（形式、重複チェック、有効範囲チェック）
- 勤務地選択機能（飯田橋/客先常駐/自宅等）
- 顧客名・プロジェクト名選択機能
- 入力データ保存機能

#### US-004-2: 月次集計・提出機能
**受け入れ基準**: AC-004-2  
**優先度**: P0  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、月次勤務表を集計・提出したい、月次報告を完了するため。

**詳細**:
- 月次集計処理
- 月次提出機能
- 提出状況記録機能

#### US-004-3: Excelエクスポート機能
**受け入れ基準**: AC-004-3  
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
ユーザーとして、勤務表をExcel形式でエクスポートしたい、会社のテンプレート形式で出力するため。

**詳細**:
- Excelファイル生成機能（会社テンプレート形式）
- 必要な情報の出力（日次勤務時間、休憩時間、勤務地、顧客名、プロジェクト名等）
- ファイルダウンロード機能

**考慮事項**:
- 午前休・午後休の場合、勤務表には勤務時間（午後または午前の勤務時間）と休日の選択（午前休または午後休）の両方を出力する必要がある
- 全日休の場合は休日のみを出力
- 日報提出時に午前休・午後休を選択した場合、勤務表への反映時に適切に処理する

#### US-004-4: SharePointへの自動アップロード機能（スケジュール実行）
**受け入れ基準**: AC-004-4  
**優先度**: P1  
**見積り**: 8ポイント  
**説明**:  
システムとして、勤務表をSharePointに自動アップロードしたい、手動操作を不要にするため。

**詳細**:
- Microsoft Graph API認証フロー（ユーザー認証方式）
- SharePoint保存先設定機能（Teamsフォルダパス）
- スケジュール設定機能（月次等）
- EventBridgeスケジュール設定
- Lambda関数: 勤務表自動出力・アップロード処理（別リポジトリ）
- アップロード状況確認機能
- リフレッシュトークンによる自動更新機能

#### US-004-5: 顧客名・プロジェクト名設定機能
**受け入れ基準**: AC-004-5  
**優先度**: P0  
**見積り**: 2ポイント  
**説明**:  
ユーザーとして、顧客名・プロジェクト名を設定・管理したい、勤務表入力時に選択できるようにするため。

**詳細**:
- 設定画面（顧客名・プロジェクト名の登録・編集）
- 複数の顧客名・プロジェクト名管理機能
- 勤務表入力時の選択機能

#### US-004-6: 自動出力機能
**受け入れ基準**: AC-004-6  
**優先度**: P1  
**見積り**: 5ポイント  
**説明**:  
システムとして、休日登録完了時に勤務表を自動出力したい、手動操作を不要にするため。

**詳細**:
- 休日登録完了時の自動出力トリガー
- EventBridgeイベント送信機能
- Lambda関数: 勤務表自動出力処理（別リポジトリ）
- 未完了時の通知機能

#### US-004-7: 月別記入状況確認・登録・編集機能
**受け入れ基準**: AC-004-7  
**優先度**: P0  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、月別の勤務表記入状況を確認・登録・編集したい、月次管理を効率化するため。

**詳細**:
- 月別一覧画面
- 記入状況表示機能
- 個別勤務表の登録・編集機能

---

### Epic 5: アイデア共有（FR-006）

#### US-006-1: アイデア投稿機能
**優先度**: P2  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、アイデアを投稿したい、チームで共有するため。

**詳細**:
- アイデア投稿画面（タイトル、概要、インパクト、コスト、担当者等）
- MongoDBスキーマ定義
- アイデア保存機能

#### US-006-2: アイデア評価機能
**優先度**: P2  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、アイデアを評価したい、良いアイデアを可視化するため。

**詳細**:
- いいね機能
- コメント機能
- 評価表示機能

#### US-006-3: アイデアステータス管理機能
**優先度**: P2  
**見積り**: 2ポイント  
**説明**:  
ユーザーとして、アイデアのステータスを管理したい、進捗を把握するため。

**詳細**:
- ステータス管理（検討中/採用/却下）
- ステータス更新機能

---

### Epic 6: スケジュール集約（FR-007）

#### US-007-1: Outlook Graph API連携準備
**優先度**: P2  
**見積り**: 5ポイント  
**説明**:  
システムとして、Outlook Graph APIと連携したい、スケジュールを取得するため。

**詳細**:
- Azure ADアプリ権限設定
- Graph APIクライアント実装
- 認証フロー実装

#### US-007-2: スケジュール同期機能
**優先度**: P2  
**見積り**: 5ポイント  
**説明**:  
システムとして、Outlookカレンダーからスケジュールを同期したい、社内イベントを可視化するため。

**詳細**:
- 初回同期API
- 増分同期API
- スケジュールエンティティ定義（MySQL）

#### US-007-3: カレンダー表示機能
**優先度**: P2  
**見積り**: 3ポイント  
**説明**:  
ユーザーとして、スケジュールをカレンダーで確認したい、社内イベントを把握するため。

**詳細**:
- カレンダー表示画面
- スケジュール検索・フィルタ機能

---

### Epic 7: 通知（FR-008）

#### US-008-1: 日報未提出アラート機能
**受け入れ基準**: AC-008-1  
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
システムとして、日報未提出時に通知を送信したい、提出忘れを防ぐため。

**詳細**:
- 日報未提出検知機能
- 通知送信機能（18:00と翌日9:30）
- EventBridgeスケジュール設定
- Lambda関数: 日報未提出検知・通知送信処理（別リポジトリ、通知設定を参照）

**考慮事項**:
- 休日が登録されている場合（全日休など）は日報を提出する必要がないため、リマインド通知を送信しない制御が必要
- 午前休・午後休の場合は日報提出が必要なため、通知を送信する
- 休日登録情報を参照して、通知送信の判定を行う

#### US-008-2: 勤務表入力未完了通知機能
**受け入れ基準**: AC-008-2  
**優先度**: P0  
**見積り**: 3ポイント  
**説明**:  
システムとして、月次提出時に未完了メンバーへ通知を送信したい、入力漏れを防ぐため。

**詳細**:
- 勤務表入力未完了検知機能
- 通知送信機能
- 未完了メンバーへの通知機能

#### US-008-3: 通知設定機能（ON/OFF）
**受け入れ基準**: AC-008-3  
**優先度**: P0  
**見積り**: 2ポイント  
**説明**:  
ユーザーとして、通知の利用/非利用を設定したい、不要な通知を避けるため。

**詳細**:
- 通知設定画面
- 通知の利用/非利用設定
- 通知種別ごとのON/OFF設定
- 通知設定エンティティ定義

#### US-008-4: 提出期限リマインド機能
**受け入れ基準**: AC-008-4  
**優先度**: P1  
**見積り**: 2ポイント  
**説明**:  
システムとして、提出期限前にリマインド通知を送信したい、期限を守らせるため。

**詳細**:
- 提出期限設定機能
- リマインド通知送信機能

---

### Epic 8: インフラ構築

#### US-009-1: 開発環境構築
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
開発者として、開発環境を構築したい、開発を開始するため。

**詳細**:
- Next.jsプロジェクトセットアップ（`apps/frontend`）
- Nest.jsプロジェクトセットアップ（`apps/backend`）
- TypeScript設定、ESLint/Prettier設定
- モノレポ管理ツールの導入（npm workspaces または pnpm）
- Docker環境構築（Dockerfile、docker-compose.yml）
- MySQL、MongoDB、Redisの初期化スクリプト

#### US-009-2: 認証基盤構築
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
開発者として、認証基盤を構築したい、セキュアな認証機能を実現するため。

**詳細**:
- Azure ADアプリ登録（開発用）
- Nest.js側の認証モジュール実装（Passport + OpenID Connect）
- Next.js側の認証状態管理（Middleware、Server Components）
- RBACのGuard実装（`@Roles()` デコレータ）
- ユーザー情報のDB保存（MySQL）

#### US-009-3: データベース実装
**優先度**: P0  
**見積り**: 3ポイント  
**説明**:  
開発者として、データベースを実装したい、データを保存するため。

**詳細**:
- TypeORMエンティティ定義
- マイグレーションファイル作成
- MongoDBスキーマ実装（アイデア用）

#### US-009-4: 共通基盤実装
**優先度**: P0  
**見積り**: 3ポイント  
**説明**:  
開発者として、共通基盤を実装したい、開発効率を向上させるため。

**詳細**:
- エラーハンドリング（グローバル例外フィルター）
- ログ設定（構造化ログ）
- APIドキュメント（Swagger）設定
- 環境変数管理（`.env.example` 作成）

#### US-009-5: IaC構築（Terraform / AWS CDK）
**優先度**: P0  
**見積り**: 8ポイント  
**説明**:  
開発者として、AWSリソースをIaCで管理したい、インフラをコードで管理するため。

**詳細**:
- TerraformまたはAWS CDKの選定・セットアップ
- AWSリソース定義（CloudFront、S3、EventBridge、Lambda、IAMなど）
- 環境ごとの設定分離（開発/ステージング/本番）
- IaCのCI/CDパイプライン構築（plan/diffの自動実行）

#### US-009-6: Lambda別プロジェクト構築
**優先度**: P0  
**見積り**: 3ポイント  
**説明**:  
開発者として、Lambda関数を別プロジェクトで管理したい、保守性を向上させるため。

**詳細**:
- Lambdaプロジェクト用の別リポジトリ作成
- LambdaプロジェクトのCI/CDパイプライン構築

#### US-009-7: CI/CD構築（GitHub Actions）
**優先度**: P0  
**見積り**: 5ポイント  
**説明**:  
開発者として、CI/CDを構築したい、自動デプロイを実現するため。

**詳細**:
- GitHub Actionsワークフロー作成（単一ワークフローでフロント・バックを統合デプロイ）
- 自動テスト実行
- バックエンドデプロイステップ: Dockerイメージビルド、ECRプッシュ、ECS/Fargateデプロイ
- フロントエンドデプロイステップ: Next.jsビルド、S3アップロード、CloudFrontキャッシュ無効化
- IaC適用ステップ（インフラ変更の自動適用）
- デプロイ完了通知機能
- 本番デプロイパイプライン（手動承認付き）
- AWS認証情報のSecrets設定

---

## 優先順位マトリックス

| 優先度 | エピック | 開発フェーズ |
|--------|---------|------------|
| P0（最優先） | Epic 1: 認証・認可 | Phase 2 |
| P0（最優先） | Epic 2: 日報管理 | Phase 3 |
| P0（最優先） | Epic 4: 勤務表管理 | Phase 3 |
| P0（最優先） | Epic 7: 通知 | Phase 4 |
| P0（最優先） | Epic 8: インフラ構築 | Phase 2, Phase 6 |
| P0（最優先） | Epic 3: 休日登録 | Phase 3, Phase 4 |
| P2（後回し） | Epic 5: アイデア共有 | Phase 5 |
| P2（後回し） | Epic 6: スケジュール集約 | Phase 5 |

---

## 見積り合計（ストーリーポイント）

### Must要件（P0）
- Epic 1: 認証・認可 - 10ポイント
- Epic 2: 日報管理 - 13ポイント
- Epic 3: 休日登録 - 16ポイント
- Epic 4: 勤務表管理 - 26ポイント
- Epic 7: 通知 - 12ポイント
- Epic 8: インフラ構築 - 32ポイント
- **合計: 109ポイント**

### Should要件（P1, P2）
- Epic 5: アイデア共有 - 8ポイント
- Epic 6: スケジュール集約 - 13ポイント
- **合計: 21ポイント**

### 将来拡張（P2）
- US-002-2: 日報テンプレート編集機能 - 3ポイント
- 注: ユーザー要望に応じて実装を検討

### 全体合計
- **130ポイント**

※ 1ポイント = 半日〜1日程度を想定（個人開発の場合）

---

## 関連ドキュメント

- [プロダクト要件定義書](./product-requirements.md)
- [受け入れ基準](./acceptance-criteria.md)
- [開発スケジュール](./development-schedule.md)
- [個人利用フェーズでの成功指標](./success-indicators.md)

---

※ 本ドキュメントは Phase 0（要件定義）で作成し、開発の進捗とともに随時更新・詳細化してください。

