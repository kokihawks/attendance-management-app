# 受け入れ基準 (Acceptance Criteria)

## 概要

本ドキュメントは、個人利用フェーズにおける各機能要件の受け入れ基準を定義します。各機能が完成したと判断するための条件を明確化し、開発・テスト・検証の基準とします。

## 対象フェーズ

- **個人利用フェーズ**: 開発者自身が日々の業務で活用し、機能検証と改善を行うフェーズ

## 機能要件別の受け入れ基準

### FR-001: 認証/認可

#### AC-001-1: ログイン機能

**Given** (前提条件):
- Google OAuth2が利用可能である
- ユーザーが有効なGoogleアカウントを持っている

**When** (操作):
- ログイン画面でGoogle OAuth2認証を実行する

**Then** (期待結果):
- 認証が成功し、アプリケーションにアクセスできる
- ユーザー情報が正しく取得される
- セッションが適切に管理される

#### AC-001-2: ロール管理

**Given** (前提条件):
- ユーザーがログインしている
- システムに4つのロール（システム管理者/マネージャー/社員/パートナー）が定義されている

**When** (操作):
- ユーザーのロールを確認する

**Then** (期待結果):
- ユーザーに適切なロールが割り当てられている
- ロールに応じた権限が適用される

#### AC-001-3: メールアドレス管理

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- メールアドレスを登録・編集する

**Then** (期待結果):
- メールアドレスが正しく保存される
- 登録したメールアドレスから日報等を送信できる

---

### FR-002: 日報管理

#### AC-002-1: 日報作成

**Given** (前提条件):
- ユーザーがログインしている
- 日報作成画面にアクセスできる

**When** (操作):
- 日報の各項目（日付、業務内容、成果、課題、翌日予定等）を入力し、送信する

**Then** (期待結果):
- 日付のバリデーションが正しく行われる
  - 日付の形式が正しいこと（YYYY-MM-DD形式等）
  - 同じ日付の日報が既に存在する場合、重複エラーが表示される
  - 未来日付の日報は作成できない（過去または当日のみ）
  - 無効な日付（存在しない日付等）は入力できない
- 日報がデータベースに保存される
- 送信完了の通知が表示される
- 日報履歴画面に新しい日報が表示される
- 勤務地（飯田橋/自宅等）が正しく記録される

#### AC-002-2: 日報テンプレート編集

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 日報テンプレートを編集する

**Then** (期待結果):
- テンプレートが保存される
- 次回の日報作成時に編集したテンプレートが適用される

#### AC-002-3: 日報履歴検索

**Given** (前提条件):
- ユーザーがログインしている
- 過去の日報が存在する

**When** (操作):
- 日報履歴画面で検索条件を指定して検索する

**Then** (期待結果):
- 条件に一致する日報が表示される
- 日付範囲、キーワード等で検索できる

#### AC-002-4: 日報提出状況トラッキング

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 日報提出状況を確認する

**Then** (期待結果):
- 提出済み/未提出の日報が正しく表示される
- 提出率が計算される

---

### FR-003: 休日登録

#### AC-003-1: 休日登録

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 休日登録画面で休暇情報（開始日、終了日、期間、理由、休日種別等）を入力し、登録する

**Then** (期待結果):
- 日付のバリデーションが正しく行われる
  - 日付の形式が正しいこと（YYYY-MM-DD形式等）
  - 開始日が終了日より後である場合、エラーが表示される
  - 同じ期間の休日が既に存在する場合、重複エラーが表示される
  - 無効な日付（存在しない日付等）は入力できない
  - 期間が有効な範囲内であること
- 休日種別（全日休/午前休/午後休）が選択できる
- 休日情報がデータベースに保存される
- カレンダーに休日が表示される
- 勤務表に自動反映される
- **考慮事項**: 午前休・午後休の場合、勤務表には勤務時間と休日の選択の両方が出力される必要がある

#### AC-003-2: カレンダー表示

**Given** (前提条件):
- ユーザーがログインしている
- 休日が登録されている

**When** (操作):
- カレンダー画面を表示する

**Then** (期待結果):
- 登録した休日がカレンダー上に表示される
- 月次・週次表示が可能である

#### AC-003-3: 勤務表への自動反映

**Given** (前提条件):
- ユーザーがログインしている
- 休日が登録されている

**When** (操作):
- 勤務表を確認する

**Then** (期待結果):
- 登録した休日が勤務表に自動反映される
- 休日が正しい日付に反映されている
- **考慮事項**: 午前休・午後休の場合、勤務表には勤務時間（午後または午前の勤務時間）と休日の選択（午前休または午後休）の両方が出力される。全日休の場合は休日のみが出力される

#### AC-003-4: Outlookカレンダー連携（Microsoft Graph API）

**Given** (前提条件):
- ユーザーがログインしている（Google OAuth2）
- ユーザーがMicrosoftアカウント（会社のアカウント）で別途認証している
- Microsoft Graph APIのアクセストークンが取得・保存されている
- 休日が登録されている

**When** (操作):
- 休日を登録する

**Then** (期待結果):
- Outlookカレンダー（Microsoft Graph API）に休日が反映される
- チームがカレンダーで休日を確認できる
- アクセストークンが期限切れの場合は、リフレッシュトークンで自動更新される

---

### FR-004: 勤務表管理

#### AC-004-1: 日次入力

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 勤務表の日次入力画面で日付、勤務時間、休憩時間、勤務地等を入力し、保存する

**Then** (期待結果):
- 日付のバリデーションが正しく行われる
  - 日付の形式が正しいこと（YYYY-MM-DD形式等）
  - 同じ日付の勤務表が既に存在する場合、重複エラーが表示される（または上書き確認が表示される）
  - 無効な日付（存在しない日付等）は入力できない
  - 有効な日付範囲内であること（例：当月内など）
- 入力した情報がデータベースに保存される
- 勤務地（飯田橋/客先常駐/自宅等）が正しく記録される
- 顧客名・プロジェクト名が正しく記録される

#### AC-004-2: 月次集計・提出

**Given** (前提条件):
- ユーザーがログインしている
- 月次勤務表の入力が完了している

**When** (操作):
- 月次勤務表を提出する

**Then** (期待結果):
- 月次勤務表が提出済みとして記録される
- 提出状況が確認できる

#### AC-004-3: Excelエクスポート

**Given** (前提条件):
- ユーザーがログインしている
- 勤務表データが存在する

**When** (操作):
- 勤務表をはExcel形式でエクスポートする

**Then** (期待結果):
- 正しい形式のExcelファイルが生成される
- ファイルに必要な情報（日次勤務時間、休憩時間、勤務地、顧客名、プロジェクト名等）が含まれている
- ファイルをダウンロードできる
- **考慮事項**: 午前休・午後休の場合、勤務表には勤務時間（午後または午前の勤務時間）と休日の選択（午前休または午後休）の両方が出力される。全日休の場合は休日のみが出力される

#### AC-004-4: SharePointへの自動アップロード（スケジュール実行）

**Given** (前提条件):
- ユーザーがログインしている（Google OAuth2）
- ユーザーがMicrosoftアカウント（会社のアカウント）で別途認証している
- Microsoft Graph APIのアクセストークンが取得・保存されている
- 勤務表がExcel形式で出力されている
- SharePointの保存先（Teamsフォルダパス）が設定されている
- スケジュール（月次等）が設定されている

**When** (操作):
- スケジュールに従って勤務表をExcel形式で出力し、SharePointへの自動アップロードが実行される

**Then** (期待結果):
- スケジュールに従ってExcelファイルがSharePointの指定されたTeamsフォルダに自動アップロードされる
- ファイルが正しい形式で保存される
- アップロード状況が確認できる
- アクセストークンが期限切れの場合は、リフレッシュトークンで自動更新される
- スケジュール実行のログが記録される

#### AC-004-5: 顧客名・プロジェクト名設定

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 設定画面で顧客名・プロジェクト名を登録・編集する

**Then** (期待結果):
- 顧客名・プロジェクト名が保存される
- 勤務表入力時に選択できる
- 複数の顧客名・プロジェクト名を管理できる

#### AC-004-6: 自動出力機能

**Given** (前提条件):
- ユーザーがログインしている
- 休日登録が完了している

**When** (操作):
- 休日登録完了時に自動出力が実行される

**Then** (期待結果):
- 勤務表が自動的に出力される
- 出力されたファイルが正しい形式である
- 未完了時には適切な通知が送信される

#### AC-004-7: 月別記入状況確認・登録・編集

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 月別一覧画面から個別の勤務表を確認・登録・編集する

**Then** (期待結果):
- 月別の勤務表一覧が表示される
- 個別の勤務表を登録・編集できる
- 記入状況が確認できる

---

### FR-008: 通知

#### AC-008-1: 日報未提出アラート

**Given** (前提条件):
- ユーザーがログインしている
- 日報未提出の状態である

**When** (操作):
- 日報未提出時に通知が送信される（18:00と翌日9:30）

**Then** (期待結果):
- 指定時刻に通知が送信される
- ユーザーに通知が届く
- 通知内容が適切である
- **考慮事項**: 休日が登録されている場合（全日休など）は日報を提出する必要がないため、リマインド通知を送信しない。午前休・午後休の場合は日報提出が必要なため、通知を送信する。休日登録情報を参照して、通知送信の判定を行う

#### AC-008-2: 勤務表入力未完了通知

**Given** (前提条件):
- ユーザーがログインしている
- 月次提出時に勤務表入力が未完了である

**When** (操作):
- 月次提出時に未完了メンバーへ通知が送信される

**Then** (期待結果):
- 未完了メンバーに通知が送信される
- 通知内容が適切である

#### AC-008-3: 通知設定（ON/OFF）

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 通知設定画面で通知の利用/非利用を設定する

**Then** (期待結果):
- 通知設定が保存される
- 設定に応じて通知が送信される/されない
- 通知種別ごとにON/OFFを設定できる

#### AC-008-4: 提出期限リマインド

**Given** (前提条件):
- ユーザーがログインしている
- 提出期限が設定されている

**When** (操作):
- 提出期限前にリマインド通知が送信される

**Then** (期待結果):
- 適切なタイミングでリマインド通知が送信される
- 通知内容が適切である

---

## 非機能要件の受け入れ基準

### NFR-001: 操作性

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 各機能を利用する

**Then** (期待結果):
- 個人利用でストレスなく利用できるUI/UXである
- 操作が直感的である
- エラーメッセージが分かりやすい

### NFR-002: 可用性

**Given** (前提条件):
- システムが稼働している

**When** (操作):
- システムにアクセスする

**Then** (期待結果):
- 個人利用時は許容範囲で柔軟運用できる
- システムが正常に動作する

### NFR-003: セキュリティ

**Given** (前提条件):
- ユーザーがログインしている

**When** (操作):
- 各機能を利用する

**Then** (期待結果):
- 適切な権限管理が実装されている
- 個人情報が適切に保護される

### NFR-004: 保守性

**Given** (前提条件):
- システムが稼働している

**When** (操作):
- コードを確認する

**Then** (期待結果):
- 小規模開発でも保守しやすいアーキテクチャである
- モジュール化されている

### NFR-005: 拡張性

**Given** (前提条件):
- システムが稼働している

**When** (操作):
- 新機能を追加する

**Then** (期待結果):
- フェーズ増加に合わせて機能を拡張可能である
- プラガブルな設計になっている

### NFR-006: インフラ管理

**Given** (前提条件):
- AWSリソースが存在する

**When** (操作):
- インフラを確認する

**Then** (期待結果):
- AWSリソースがすべてIaCで管理されている
- TerraformまたはAWS CDKで定義されている

---

## 関連ドキュメント

- [プロダクト要件定義書](./product-requirements.md)
- [開発スケジュール](./development-schedule.md)
- [個人利用フェーズでの成功指標](./success-indicators.md)

---

※ 本ドキュメントは Phase 0（要件定義）で作成し、開発の進捗とともに随時更新・詳細化してください。

