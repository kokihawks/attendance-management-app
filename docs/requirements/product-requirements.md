# プロダクト要件定義書（エイ・フォース勤怠管理アプリ）

## 1. プロジェクト概要
- **プロジェクト名**: エイ・フォース勤怠管理アプリ
- **目的**: 日報作成や勤務表記入などの日常業務を一元化し、情報共有と業務効率の向上を実現する。
- **開発体制**: 個人開発を起点に、段階的に自部署・全社へ展開する。
- **導入ステージ**:
  1. **個人利用**: 開発者自身が日々の業務で活用し、機能検証と改善を行う。
  2. **チーム導入**: 自チーム（少人数）に展開し、運用フローを固める。
  3. **全社展開**: 組織全体での利用を視野に入れ、共通要件やガバナンスを整備する。
- **想定ユーザー**:
  - フェーズ1（個人）: 開発者本人
  - フェーズ2（チーム）: チームメンバー、チームリーダー
  - フェーズ3（全社）: 管理部門、他部署メンバー

## 2. 成功指標 (KPI)
- フェーズ1: 日報・勤務表の自己提出率 100%、週1回以上の機能改善
- フェーズ2: チーム内提出率 90%以上、チームリーダーによる承認遅延 30%削減
- フェーズ3: 全社展開前にパイロットチームで満足度 80%以上、問い合わせ件数の減少

## 3. ユースケース
1. **日報作成**: ユーザーが業務終了後にテンプレートを使って日報を作成・提出する。
2. **休日登録**: ユーザーが休暇申請を行い、リーダーが承認状況を確認する。
3. **勤務表記入**: 月次勤務表を日次で入力し、月末に提出・承認を行う。
4. **日報ネタ帳**: 日報の話題候補をメモし、日報作成時に参照する。
5. **アイデアネタ蓄積**: 業務改善やプロジェクトのアイデアを共有する。
6. **スケジュール収集**: 社内イベントや期限付きタスクをカレンダーで可視化する。

## 4. 機能要件 (Functional Requirements)
| ID | 機能 | 内容 | 優先度 | 備考 |
| -- | ---- | ---- | ---- | ---- |
| FR-001 | 認証/認可 | ログイン、ロール管理（管理者/チーム管理者/社員/パートナー）、メールアドレス登録・管理 | Must | 初期は Azure AD を利用、各アカウントのメールアドレスから送信可能にする。4つのロールで権限管理を実装 |
| FR-002 | 日報管理 | 日報作成、テンプレート編集、履歴検索、コメント、提出状況トラッキング、勤務地選択（飯田橋/客先常駐/自宅等） | Must | 個人利用から開始し、チーム共有用の公開範囲・提出状況ダッシュボードを拡張 |
| FR-003 | 休日登録 | 休日登録、カレンダー表示、勤務表への自動反映、マネージャー向け可視化 | Must | 登録した休日は自動的に勤務表へ出力し、Outlook カレンダーに反映してチームが確認できるようにする |
| FR-004 | 勤務表管理 | 日次入力、月次集計・提出、PDF/CSV エクスポート、勤務地選択（飯田橋/客先常駐/自宅等）、顧客名・プロジェクト名設定、自動出力機能、月別記入状況確認・登録・編集 | Must | 個人用集計 → チーム/管理部門向けエクスポートを追加。設定変更ページで顧客名・プロジェクト名を管理。休日登録完了時は自動出力、未完了時は通知。月別一覧画面から個別の勤務表を登録・編集可能 |
| FR-005 | ネタ帳 | 日報ネタのメモ登録、タグ付け、検索 | Should | 個人メモ → チーム共有を段階的に解放 |
| FR-006 | アイデア共有 | アイデア投稿、評価、コメント、ステータス管理 | Should | チームフィードバックを得て全社展開を検討 |
| FR-007 | スケジュール集約 | 社内イベント・期限タスクのカレンダー表示 | Should | Outlook カレンダー連携を優先実装し、将来拡張を検討 |
| FR-008 | 通知 | 提出期限、承認結果、スケジュールリマインド、未提出アラート、勤務表入力未完了通知、通知設定（ON/OFF） | Must | フェーズ別に通知チャネルを拡張（本人と管理者に通知）。日報未提出時の催促通知を18:00と翌日9:30に送信。勤務表の月次提出時に未完了メンバーへ通知送信機能。ユーザーごとに通知の利用/非利用を設定可能 |

## 5. 非機能要件 (Non-Functional Requirements)
| ID | 区分 | 要件 | 備考 |
| -- | ---- | ---- | ---- |
| NFR-001 | 操作性 | 個人利用でストレスなく利用できる UI/UX | チーム展開に向けてフィードバックを迅速に反映 |
| NFR-002 | 可用性 | チーム導入時に稼働率 99.5% を目指す | 個人利用時は許容範囲で柔軟運用 |
| NFR-003 | セキュリティ | 個人→チーム→全社に合わせて権限管理を強化 | Azure AD 連携、監査ログは段階的に追加 |
| NFR-004 | 保守性 | 小規模開発でも保守しやすいアーキテクチャ | モジュール化と自動テストで段階的に品質向上 |
| NFR-005 | 拡張性 | フェーズ増加に合わせて機能を拡張可能 | プラガブルな設計、設定で機能ON/OFF |
| NFR-006 | インフラ管理 | AWS リソースはすべて IaC で管理 | Terraform または AWS CDK を使用し、コードでインフラを定義・管理 |

## 6. 技術スタック前提
- **フロントエンド**: Next.js + Tailwind CSS (TypeScript)
- **バックエンド**: Nest.js (TypeScript)
- **データベース**:
  - MySQL: 勤怠・日報・ユーザー情報など構造化データ
  - MongoDB: ネタ帳・アイデアなど柔軟なドキュメントデータ
- **インフラ**: 
  - 開発環境: Docker / Docker Compose
  - 本番環境: AWS CloudFront（フロントエンド配信）、S3（静的ファイル保存）、EventBridge、Lambda
  - **IaC**: AWS リソースはすべて Infrastructure as Code（Terraform または AWS CDK）で管理
- **非同期処理**: AWS EventBridge + Lambda（勤務表自動出力など）、BullMQ + Redis（通知送信など）
  - **Lambda 開発**: 別プロジェクト（リポジトリ）で管理
- **CI/CD**: GitHub Actions による自動デプロイ

## 7. データ項目例
- **日報**: 日付、業務内容、成果、課題、翌日予定、添付ファイル、参照ネタ、公開範囲、勤務地（飯田橋/客先常駐/自宅等）
- **休日登録**: 登録者、期間、理由（任意）、登録日時、Outlook イベントID、共有カレンダー情報
- **勤務表**: 日次勤務時間、休憩時間、残業、コメント、承認履歴、勤務地（飯田橋/客先常駐/自宅等）、顧客名、プロジェクト名
- **勤務表設定**: 顧客名、プロジェクト名（ユーザーごとの設定管理）
- **通知設定**: 通知の利用/非利用、通知種別ごとのON/OFF（日報催促、勤務表入力未完了通知など）
- **ネタ帳**: タイトル、カテゴリ、タグ、本文、関連リンク、公開範囲
- **アイデア**: タイトル、概要、インパクト、コスト、担当者、ステータス
- **スケジュール**: イベント名、日時、関係者、通知設定

## 8. リスク・検討課題
| リスク | 影響 | 暫定対応策 |
| ---- | ---- | ---- |
| 個人開発による工数不足 | 開発遅延 | 機能スコープを段階的に絞り、優先順位を明確化 |
| チーム導入時の要件変動 | 再開発・手戻り | チーム導入前にヒアリングを行い、段階的リリース |
| 全社展開時の統制要件 | 運用負荷の増加 | 早期にセキュリティ/監査要件を整理し、設計に反映 |

## 9. オープン事項
- チーム導入時の承認フロー詳細（多段承認の有無、締め日）
- 全社展開時の標準日報テンプレート定義
- Outlook 連携の社内テナント権限調整プロセス
- 通知チャネル（メール、チャット、プッシュ）の段階的導入方針
- ガバナンス要件（監査、データ保持期間、アクセス権限）

---
※ 本ドキュメントは段階的導入を前提とした初期ドラフトです。利用フェーズごとにフィードバックを反映し、随時更新してください。

