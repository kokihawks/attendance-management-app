# 開発スケジュール

## 概要

本プロジェクトは MVP（最小限の機能）から段階的に機能を追加するアプローチで進めます。各フェーズで動作するプロダクトをリリースし、フィードバックを反映しながら拡張していきます。

## 開発フェーズ

### Phase 0: 要件定義フェーズ（2-3週間）

**目標**: 自身の業務フローと導入計画を整理し、MVP スコープと成功指標を明確化する。

#### タスク一覧

1. **業務棚卸と現状分析**
   - [x] 現行の日報・勤務管理フローの洗い出し
     - [x] **日報作成フロー**: 現在の手段、使用ツール、提出先、頻度、所要時間、課題
     - [x] **勤務表管理フロー**: 入力方法、集計方法、提出先、締め日、承認プロセス、課題（月次提出、自動出力要件含む）
     - [x] **休日登録フロー**: 登録手段、承認手順、通知方法、課題（Outlook連携要件含む）
   - [x] 課題・非効率ポイントの整理（[課題・非効率ポイント整理](./issues-and-improvements.md) を参照）
   - [x] 個人利用フェーズでの成功指標の定義

2. **要件ドキュメント整備**
   - [x] ユーザーペルソナとユースケースの詳細化（4つのロール: システム管理者/マネージャー/社員/パートナー）
   - [x] 機能/非機能要件の優先順位付け（FR-001〜FR-008、NFR-001〜NFR-006）
   - [x] 受入基準 (Acceptance Criteria) の策定（[受け入れ基準](./acceptance-criteria.md) を参照）
   - [x] リスク・課題一覧の更新
   - [x] 技術スタックの確定（Next.js、Nest.js、MySQL、MongoDB、CloudFront、EventBridge、Lambda、IaC）
   - [x] デプロイ方針の確定（CloudFront、GitHub Actions、統合デプロイ）

3. **プロダクトバックログ作成**
   - [x] エピック・ユーザーストーリーの洗い出し
     - [x] 認証・認可（4ロール管理、メールアドレス管理）
     - [x] 日報管理（作成、提出、通知、勤務地選択）
     - [x] 休日登録（登録、Outlook連携、勤務表自動反映）
     - [x] 勤務表管理（日次入力、月次提出、自動出力、設定管理）
     - [x] 通知機能（未提出アラート、勤務表入力未完了通知）
     - [x] インフラ構築（IaC、Lambda別プロジェクト）
   - [x] ストーリーポイントまたは相対見積りの実施
   - [ ] バックログ管理ツールの初期設定（GitHub Projects）
     - [ ] GitHub Projectsの作成
     - [ ] カスタムフィールドとラベルの設定
     - [ ] マイルストーンの設定
     - [ ] エピックIssueの登録
     - [ ] ユーザーストーリーIssueの登録
     - [ ] プロジェクトへの追加と整理

**成果物**: 合意済みの要件定義書、優先順位付きプロダクトバックログ、個人利用フェーズでの成功指標定義（[成功指標](./success-indicators.md) を参照）

---

### Phase 1: 詳細設計フェーズ（3週間）

**目標**: 実装に向けてアーキテクチャ・API・UI の詳細を確定し、開発の準備を整える。

#### タスク一覧

1. **アーキテクチャ確定**
   - [ ] アーキテクチャ設計書の更新
   - [ ] モジュール構成と依存関係の定義
   - [ ] 非機能要件に対する設計方針の明文化

2. **データ・API 設計**
   - [ ] ER 図・データモデルの確定
   - [ ] API スキーマ（OpenAPI/Swagger）のドラフト作成
   - [ ] DTO / Validation ルールの定義

3. **UI/UX 設計**
   - [ ] 主要画面のワイヤーフレーム/モック作成
   - [ ] 画面遷移図・状態遷移図の作成
   - [ ] レイアウト・コンポーネント設計指針の策定

4. **運用設計**
   - [ ] ログ・監視・通知ポリシーの素案策定
   - [ ] 開発プロセス・レビュー体制の定義
   - [ ] リリース計画の初期ドラフト作成

**成果物**: 詳細設計書、API/DB スキーマ、画面設計資料、開発計画書

---

### Phase 2: 基盤構築（2-3週間）

**目標**: 開発環境の構築と認証基盤の実装

#### タスク一覧

1. **プロジェクト初期化**
   - [ ] Next.js プロジェクトのセットアップ（`apps/frontend`）
   - [ ] Nest.js プロジェクトのセットアップ（`apps/backend`）
   - [ ] TypeScript 設定、ESLint/Prettier 設定
   - [ ] モノレポ管理ツールの導入（npm workspaces または pnpm）

2. **Docker 環境構築**
   - [ ] 各アプリケーションの Dockerfile 作成
   - [ ] docker-compose.yml の調整・動作確認
   - [ ] MySQL、MongoDB、Redis の初期化スクリプト作成
   - [ ] 開発環境での起動確認

3. **認証・認可基盤**
   - [ ] Azure AD アプリ登録（開発用）
   - [ ] Nest.js 側の認証モジュール実装（Passport + OpenID Connect）
   - [ ] Next.js 側の認証状態管理（Middleware、Server Components）
   - [ ] RBAC の Guard 実装（`@Roles()` デコレータ）
   - [ ] ユーザー情報の DB 保存（MySQL）

4. **データベース実装**
   - [ ] TypeORM エンティティ定義
   - [ ] マイグレーションファイル作成
   - [ ] MongoDB スキーマ実装（アイデア用）

5. **共通基盤**
   - [ ] エラーハンドリング（グローバル例外フィルター）
   - [ ] ログ設定（構造化ログ）
   - [ ] API ドキュメント（Swagger）設定
   - [ ] 環境変数管理（`.env.example` 作成）

**成果物**: 認証機能が動作し、ログインできる状態

---

### Phase 3: MVP - コア機能（4-6週間）

**目標**: 日報と勤務表の基本機能、休日登録のコア機能を実装

#### タスク一覧

1. **日報管理機能（FR-002）**
   - [ ] 日報エンティティ・DTO 定義
   - [ ] 日報作成 API（バックエンド）
   - [ ] 日報一覧・詳細取得 API
   - [ ] 日報編集・削除 API
   - [ ] 日報作成画面（フロントエンド）
   - [ ] 日報一覧画面
   - [ ] 日報詳細・編集画面
   - [ ] テンプレート機能（基本テンプレートのみ、固定形式）
     - [ ] 基本テンプレートの実装（業務内容、成果、課題、翌日予定の固定フォーマット）
     - [ ] 日報作成時のテンプレート適用機能
     - [ ] 注: テンプレート編集機能は将来拡張として検討（Phase 5以降）

2. **休日登録機能（FR-003）- コア機能**
   - [ ] 休日登録エンティティ・DTO 定義（全日休/午前休/午後休の種別を含む）
   - [ ] 休日登録 API
   - [ ] 休日登録一覧・詳細 API
   - [ ] 休日登録画面（休日種別選択機能: 全日休/午前休/午後休）
   - [ ] 勤務表への自動反映機能
   - [ ] 考慮事項: 午前休・午後休の場合、勤務表には勤務時間と休日の選択の両方を出力する必要がある

3. **勤務表管理機能（FR-004）**
   - [ ] 勤務表エンティティ・DTO 定義
   - [ ] 日次入力 API
   - [ ] 月次集計 API
   - [ ] 勤務表登録・編集 API
   - [ ] 月別記入状況確認 API（一覧取得）
   - [ ] 勤務表入力画面（カレンダー形式）
   - [ ] 月別記入状況確認画面（一覧表示、登録・編集リンク）
   - [ ] 勤務表登録・編集画面（月別一覧から遷移）
   - [ ] 月次集計表示画面
   - [ ] Excel エクスポート機能
   - [ ] 考慮事項: 午前休・午後休の場合、勤務表には勤務時間（午後または午前の勤務時間）と休日の選択（午前休または午後休）の両方を出力する必要がある
   - [ ] AWS EventBridge + Lambda 基盤構築（自動出力用、別プロジェクトで管理）
   - [ ] Lambda 関数: 勤務表自動出力処理（Excel 生成、S3/SharePoint アップロード）※別リポジトリで実装
   - [ ] EventBridge スケジュール設定（月次トリガー）※IaC で管理

4. **基本的な UI/UX**
   - [ ] レイアウトコンポーネント（ヘッダー、サイドバー、フッター）
   - [ ] ナビゲーション
   - [ ] ローディング状態、エラー表示
   - [ ] レスポンシブデザイン（モバイル対応）

5. **テスト・品質保証**
   - [ ] ユニットテスト（Service、Repository 層）
   - [ ] E2E テスト（主要フロー）
   - [ ] コードレビュー体制の確立

**成果物**: 日報作成、勤務表入力、休日登録（コア機能）が可能な MVP リリース

---

### Phase 4: 拡張機能（3-4週間）

**目標**: 休日登録の拡張機能の追加

#### タスク一覧

1. **休日登録機能（FR-003）- 拡張機能**
   - [ ] カレンダー表示（休日可視化）
   - [ ] Outlook カレンダー連携（共有カレンダーへの自動登録）
   - [ ] Microsoft Graph API認証フロー実装
   - [ ] EventBridge イベント送信（休日登録完了時）
   - [ ] Lambda 関数: 休日登録完了時の勤務表自動出力処理※別リポジトリで実装

2. **通知機能（基本版）**
   - [ ] 通知エンティティ定義
   - [ ] 通知設定エンティティ定義（ユーザーごとの通知ON/OFF設定）
   - [ ] 通知設定API（取得・更新）
   - [ ] アプリ内通知表示
   - [ ] 承認リクエスト通知
   - [ ] 日報未提出催促通知（18:00と翌日9:30に送信、通知設定を考慮）
   - [ ] EventBridge スケジュール設定（日報催促通知用の定期実行）
   - [ ] Lambda 関数: 日報未提出検知・通知送信処理（通知設定を参照）※別リポジトリで実装
   - [ ] 考慮事項: 休日が登録されている場合（全日休など）は日報を提出する必要がないため、リマインド通知を送信しない制御を実装

**成果物**: 休日登録の拡張機能（カレンダー表示、Outlook連携）が利用可能な状態

---

### Phase 5: 高度な機能（4-5週間）

**目標**: アイデア共有とスケジュール連携の実装

#### タスク一覧

1. **アイデア共有機能（FR-006）**
   - [ ] MongoDB スキーマ定義（アイデア）
   - [ ] アイデア投稿・取得 API
   - [ ] 評価機能（いいね、コメント）
   - [ ] ステータス管理（検討中/採用/却下）
   - [ ] アイデア投稿画面
   - [ ] アイデア一覧・詳細画面
   - [ ] 評価・コメント機能

2. **スケジュール集約機能（FR-007）**
   - [ ] Outlook Graph API 連携準備
     - [ ] Azure AD アプリ権限設定
     - [ ] Graph API クライアント実装
   - [ ] スケジュール同期 API（初回同期、増分同期）
   - [ ] スケジュールエンティティ定義（MySQL）
   - [ ] カレンダー表示画面
   - [ ] スケジュール検索・フィルタ機能

3. **非同期処理基盤**
   - [ ] Redis セットアップ
   - [ ] BullMQ 導入
   - [ ] 通知送信 Worker（メール送信の準備）
   - [ ] スケジュール同期 Worker

**成果物**: アイデア共有と Outlook 連携が動作する状態

---

### Phase 6: 最適化・運用準備（3-4週間）

**目標**: パフォーマンス改善、監視体制、本番環境準備

#### タスク一覧

1. **パフォーマンス最適化**
   - [ ] フロントエンド: コード分割、画像最適化、SSG/ISR 適用
   - [ ] バックエンド: クエリ最適化、インデックス追加、キャッシュ戦略
   - [ ] データベース: 読み取り専用レプリカ検討

2. **通知機能の拡張（FR-008）**
   - [ ] メール通知実装
   - [ ] Slack 連携（オプション）
   - [ ] 通知設定画面（ユーザーごとの通知ON/OFF設定、通知種別ごとの設定）

3. **監視・ログ**
   - [ ] アプリケーションログの集約設定
   - [ ] メトリクス収集（API レスポンスタイム、エラー率）
   - [ ] アラート設定

4. **セキュリティ強化**
   - [ ] 脆弱性スキャン（依存パッケージ）
   - [ ] セキュリティヘッダー設定
   - [ ] 監査ログ実装
   - [ ] ペネトレーションテスト（簡易版）

5. **インフラ構築（IaC）**
   - [ ] Terraform または AWS CDK の選定・セットアップ
   - [ ] AWS リソース定義（CloudFront、S3、EventBridge、Lambda、IAM など）
   - [ ] 環境ごとの設定分離（開発/ステージング/本番）
   - [ ] IaC の CI/CD パイプライン構築（plan/diff の自動実行）
   - [ ] Lambda プロジェクト用の別リポジトリ作成
   - [ ] Lambda プロジェクトの CI/CD パイプライン構築

6. **CI/CD 構築**
   - [ ] GitHub Actions ワークフロー作成（単一ワークフローでフロント・バックを統合デプロイ）
   - [ ] 自動テスト実行
   - [ ] バックエンドデプロイステップ: Docker イメージビルド、ECR プッシュ、ECS/Fargate デプロイ
   - [ ] フロントエンドデプロイステップ: Next.js ビルド、S3 アップロード、CloudFront キャッシュ無効化
   - [ ] IaC 適用ステップ（インフラ変更の自動適用）
   - [ ] デプロイ完了通知機能
   - [ ] 本番デプロイパイプライン（手動承認付き）
   - [ ] AWS 認証情報の Secrets 設定

7. **ドキュメント整備**
   - [ ] API ドキュメント（Swagger）の完成
   - [ ] 運用マニュアル作成
   - [ ] 障害対応手順書

**成果物**: 本番環境で運用可能な状態

---

## マイルストーン

| マイルストーン | 目標日 | 主要成果物 |
|------------|--------|----------|
| M0: 要件定義合意 | Phase 0 完了時 | 合意済み要件定義書と優先順位付きバックログ |
| M1: 詳細設計完了 | Phase 1 完了時 | 詳細設計書・API/DB スキーマ・画面設計資料 |
| M2: 基盤完成 | Phase 2 完了時 | 認証機能が動作しログイン可能な環境 |
| M3: MVP リリース | Phase 3 完了時 | 日報・勤務表・休日登録（コア機能）が利用可能な MVP |
| M4: 拡張機能リリース | Phase 4 完了時 | 休日登録の拡張機能（カレンダー表示、Outlook連携）が利用可能 |
| M5: 高度機能リリース | Phase 5 完了時 | アイデア共有・Outlook 連携が実行可能 |
| M6: 本番リリース | Phase 6 完了時 | 本番環境で運用開始 |

## リスク管理

### 技術的リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Outlook Graph API 連携の複雑さ | 高 | Phase 5 で十分な時間を確保、早期にプロトタイプ作成 |
| 承認フローの要件不確定 | 中 | Phase 4 でステークホルダーと詳細をすり合わせ |
| パフォーマンス問題 | 中 | Phase 6 で十分な最適化時間を確保 |

### スケジュールリスク

- **バッファの確保**: 各フェーズに 1-2週間のバッファを想定
- **優先順位の見直し**: 機能追加が遅れる場合は、Must 要件を優先
- **並行作業**: フロントエンドとバックエンドは可能な限り並行開発

## 開発体制の推奨

### 最小構成（1-2名）
- Phase 0-1: 要件定義と詳細設計を並行して推進
- Phase 2-3: 基盤構築と MVP 実装を集中的に対応
- Phase 4-6: 機能拡張と運用準備を段階的に実施

### 推奨構成（3-4名）
- **フロントエンド**: 1-2名（Next.js、UI/UX）
- **バックエンド**: 1-2名（Nest.js、DB設計、外部連携）
- **インフラ/DevOps**: 0.5名（Docker、CI/CD、監視）

## 次のアクション

1. **Phase 0 の着手**: 自身の業務フローと課題を棚卸しし、要件ドキュメントを更新
2. **バックログ素案の作成**: 優先度ごとにユーザーストーリーを整理し、ツールへ登録
3. **詳細設計準備**: Phase 1 で使用する設計テンプレート（ER 図、API 定義、画面モック）を収集・整理

---

※ 本スケジュールは初期計画です。進捗に応じて随時見直しを行ってください。

## 現行業務フローメモ

### 日報作成フロー
- 現在の手段: 自分が作成したアプリケーションで日報を作成し、メールで提出
- 使用ツール: 既存の自作アプリケーション、ChatGPT（内容作成）、メール
- 提出先 / 閲覧者: 会社の日報提出用メールアドレス
- 提出頻度 / 締め時間: 業務日またはその次の日に提出
- 所要時間の目安: そこまで時間はかかっていない
- 課題・不満:
  - 現在のアプリは自分のメールアドレスからしか送信できないため、チーム導入時に各アカウントのメールアドレスから送信できない
  - 認証機能が不十分で、複数ユーザー対応ができない
  - 勤務地が自動で飯田橋になるが、客先常駐や自宅勤務の選択肢がない
  - ChatGPTで内容を作成してからコピー&ペーストしている（アプリ内で直接できたら良いが、API利用は避けたい）
  - TODOリストから日報の内容を出力できると良い（優先度低）
  - 日報を提出し忘れた場合の通知がなく、気付きづらい
  - チーム導入時にマネージャーが提出状況を把握しづらい
- 改善したいポイント:
  - しっかりとした認証機能の実装（各アカウントのメールアドレス登録・管理）
  - 各アカウントに基づくメールアドレスからの送信機能
  - 勤務地選択機能（飯田橋/客先常駐/自宅等）
  - ChatGPT連携をアプリ内で直接実現（優先度低、無料範囲でデプロイしたいためAPI利用は避ける）
  - TODOリスト連携（優先度低）
  - 提出期限・未提出検知時の通知機能（本人・マネージャー）
  - 提出状況ダッシュボードやレポートの提供

### 勤務表管理フロー
- 入力方法 / 使用ツール: 日報に勤務時間を入力する欄がある。そのデータを利用して勤務表（Excel、会社提供のテンプレート）に出力。ExcelファイルをTeamsのSharePoint（個人ディレクトリ）とAWS S3に保存。
- 集計方法: 日報の勤務時間データを利用してExcelテンプレートに出力
- 提出頻度: 1か月ごとに提出
- 提出先 / 承認者: Teams SharePointの個人ディレクトリ、AWS S3
- 締め日 / 承認期限: （未確認）
- 所要時間の目安: （未確認）
- 課題・不満:
  - 勤務地が自動で飯田橋になるが、客先常駐や自宅勤務の選択肢がない
  - 顧客名・プロジェクト名が切り替わった際に、出力内容を手動で変更する必要がある
  - 休日の時に手動で最後に調整する必要がある（面倒）
  - ExcelファイルをSharePointに入れるのが自動ではない
  - 入力が完了していない場合の通知機能がない
- 改善したいポイント:
  - 勤務地選択機能（飯田橋/客先常駐/自宅等）
  - 顧客名・プロジェクト名の設定変更ページ（切り替え時に簡単に変更可能）
  - 休日登録が完了している場合は自動で勤務表を出力する機能
  - 入力が完了していない場合は、各メンバーに通知を送って手動入力を促す機能
  - SharePointへの自動アップロード機能

### 休日申請フロー
- 申請手段 / 使用ツール: （要確認／現在は明確な仕組みがない）
- 承認フロー: マネージャーによる確認が手動で行われている
- 通知方法: （未整備）
- 所要時間の目安: （未確認）
- 課題・不満:
  - マネージャーが休暇状況を把握しづらい
  - 予定管理が Outlook と連携されておらず、確認に手間がかかる
- 改善したいポイント:
  - 休暇申請・承認をシステム内で一元管理
  - 承認結果を Outlook カレンダーに自動登録し、マネージャーが確認できるようにする
  - 休暇状況ダッシュボードを整備

### 休日登録フロー
- 登録手段 / 使用ツール: （要確認／現在は明確な仕組みがない）
- 承認フロー: 特になし（休日登録すると日報提出が不要になる運用）
- 通知方法: （未整備）
- 所要時間の目安: （未確認）
- 課題・不満:
  - 休日登録がシステム化されておらず、勤務表に反映するための手動調整が発生
  - マネージャーが休暇状況を把握しづらい
  - 予定管理が Outlook と連携されておらず、確認に手間がかかる
- 改善したいポイント:
  - アプリから休日を登録し、勤務表へ自動反映できるようにする
  - 登録された休日を Outlook の共有カレンダーに自動登録し、チームで確認できるようにする
  - 休暇状況ダッシュボードを整備

---

